<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Zentry-RTE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            background-color: #f4f4f4;
            font-family: "SF Pro", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            padding-bottom: 220px;
        }
        .terminal {
            background-color: #fff;
            color: #333;
            padding: 15px;
            font-family: monospace;
            height: 500px;
            overflow-y: auto;
            border-radius: 8px;
            box-shadow: inset 0 0 6px #ccc;
            white-space: pre-wrap;
            font-size: 13px;
        }
        .terminal div {
            cursor: pointer;
            padding: 4px 0;
            border-bottom: 1px solid #eee;
            position: relative;
        }
        .terminal div:hover {
            background-color: #f0f0f0;
        }
        .terminal input[type="checkbox"] {
            margin-right: 10px;
        }
        footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #fff;
            border-top: 1px solid #ddd;
            padding: 10px 15px;
        }
        .form-control, .form-select {
            font-size: 0.85rem;
            padding: 4px 8px;
            height: 32px;
            border-radius: 8px;
        }
        .form-container {
            overflow-x: auto;
        }
        #placa5 {
            text-transform: uppercase;
        }
    </style>
</head>
<body class="p-3">

    <h5 class="mb-3">Zentry-RTE</h5>

    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="tab1-tab" data-bs-toggle="tab" data-bs-target="#tab1" type="button" role="tab" aria-controls="tab1" aria-selected="true">Entre Locais</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab2-tab" data-bs-toggle="tab" data-bs-target="#tab2" type="button" role="tab" aria-controls="tab2" aria-selected="false">Coleta e entrega</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab3-tab" data-bs-toggle="tab" data-bs-target="#tab3" type="button" role="tab" aria-controls="tab3" aria-selected="false">293 Manuten√ß√£o</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab4-tab" data-bs-toggle="tab" data-bs-target="#tab4" type="button" role="tab" aria-controls="tab4" aria-selected="false">294 Manuten√ß√£o</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab5-tab" data-bs-toggle="tab" data-bs-target="#tab5" type="button" role="tab" aria-controls="tab5" aria-selected="false">Retira</button>
        </li>
    </ul>

    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="tab1" role="tabpanel" aria-labelledby="tab1-tab">
            <div class="mb-2 d-flex gap-2 flex-wrap mt-3">
                <input type="text" id="filtro1" class="form-control" placeholder="üîç Buscar por cavalo, motorista ou data..." style="max-width: 300px;">
                <select id="ordenarPor1" class="form-select" style="width: 200px;">
                    <option value="data">Ordenar por Data</option>
                    <option value="cavalo">Ordenar por Cavalo</option>
                    <option value="motChegada">Ordenar por Mot. Chegada</option>
                    <option value="motSaida">Ordenar por Mot. Sa√≠da</option>
                </select>
            </div>
            <div class="terminal mb-4" id="output1"></div>
        </div>
        <div class="tab-pane fade" id="tab2" role="tabpanel" aria-labelledby="tab2-tab">
            <div class="mb-2 d-flex gap-2 flex-wrap mt-3">
                <input type="text" id="filtro2" class="form-control" placeholder="üîç Buscar por motorista, frota ou data..." style="max-width: 300px;">
                <select id="ordenarPor2" class="form-select" style="width: 200px;">
                    <option value="data">Ordenar por Data</option>
                    <option value="motorista">Ordenar por Motorista</option>
                    <option value="frota">Ordenar por Frota</option>
                </select>
            </div>
            <div class="terminal mb-4" id="output2"></div>
        </div>
        <div class="tab-pane fade" id="tab3" role="tabpanel" aria-labelledby="tab3-tab">
            <div class="mb-2 d-flex gap-2 flex-wrap mt-3">
                <input type="text" id="filtro3" class="form-control" placeholder="üîç Buscar por motorista, frota ou data..." style="max-width: 300px;">
                <select id="ordenarPor3" class="form-select" style="width: 200px;">
                    <option value="data">Ordenar por Data</option>
                    <option value="motorista">Ordenar por Motorista</option>
                    <option value="frota">Ordenar por Frota</option>
                </select>
            </div>
            <div class="terminal mb-4" id="output3"></div>
        </div>
        <div class="tab-pane fade" id="tab4" role="tabpanel" aria-labelledby="tab4-tab">
            <div class="mb-2 d-flex gap-2 flex-wrap mt-3">
                <input type="text" id="filtro4" class="form-control" placeholder="üîç Buscar por motorista, frota ou data..." style="max-width: 300px;">
                <select id="ordenarPor4" class="form-select" style="width: 200px;">
                    <option value="data">Ordenar por Data</option>
                    <option value="motorista">Ordenar por Motorista</option>
                    <option value="frota">Ordenar por Frota</option>
                </select>
            </div>
            <div class="terminal mb-4" id="output4"></div>
        </div>
        <div class="tab-pane fade" id="tab5" role="tabpanel" aria-labelledby="tab5-tab">
            <div class="mb-2 d-flex gap-2 flex-wrap mt-3">
                <input type="text" id="filtro5" class="form-control" placeholder="üîç Buscar por nome, placa ou data..." style="max-width: 300px;">
                <select id="ordenarPor5" class="form-select" style="width: 200px;">
                    <option value="data">Ordenar por Data</option>
                    <option value="placa">Ordenar por Placa</option>
                    <option value="nome">Ordenar por Nome</option>
                </select>
            </div>
            <div class="terminal mb-4" id="output5"></div>
        </div>
    </div>

    <footer id="form-container-footer">
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const opcoes = ["010", "905", "004", "006", "908", "091", "094", "123", "095", "099", "906", "204", "920", "698", "240", "250", "302", "385", "404", "460", "501", "502", "570", "580", "607", "699", "912"];
        
        let editIndex = -1;
        let activeTab = 1;
        let selectedIndices = [];

        const forms = {
            1: `
                <div class="form-container d-flex flex-wrap gap-2 mb-2">
                    <input type="date" id="data1" class="form-control" style="width: 110px;">
                    <input type="text" id="cavalo1" class="form-control" placeholder="Cavalo" style="width: 80px;">
                    <input type="text" id="carreta11" class="form-control" placeholder="Carreta 01" style="width: 90px;">
                    <input type="text" id="carreta21" class="form-control" placeholder="Carreta 02" style="width: 90px;">
                    <input type="time" id="hChegada1" class="form-control" style="width: 90px;">
                    <input type="time" id="hSaida1" class="form-control" style="width: 90px;">
                    <input type="text" id="motChegada1" class="form-control" placeholder="Mot. Chegada" style="width: 100px;">
                    <input type="text" id="motSaida1" class="form-control" placeholder="Mot. Sa√≠da" style="width: 100px;">
                    <select id="origem1" class="form-select" style="width: 90px;"><option value="">Origem</option></select>
                    <select id="destino1" class="form-select" style="width: 90px;"><option value="">Destino</option></select>
                </div>
            `,
            2: `
                <div class="form-container d-flex flex-wrap gap-2 mb-2">
                    <input type="date" id="data2" class="form-control" style="width: 110px;">
                    <input type="text" id="motorista2" class="form-control" placeholder="Motorista" style="width: 120px;">
                    <input type="text" id="frota2" class="form-control" placeholder="Frota" style="width: 90px;">
                    <input type="time" id="hSaida2" class="form-control" placeholder="H. sa√≠da" style="width: 90px;">
                    <input type="time" id="hEntrada2" class="form-control" placeholder="H. entrada" style="width: 90px;">
                    <input type="number" id="kmSaida2" class="form-control" placeholder="Km. sa√≠da" style="width: 100px;">
                    <input type="number" id="kmEntrada2" class="form-control" placeholder="Km. entrada" style="width: 100px;">
                    <input type="text" id="obs2" class="form-control" placeholder="Obs" style="flex-grow: 1;">
                </div>
            `,
            3: `
                <div class="form-container d-flex flex-wrap gap-2 mb-2">
                    <input type="date" id="data3" class="form-control" style="width: 110px;">
                    <input type="text" id="motorista3" class="form-control" placeholder="Motorista" style="width: 120px;">
                    <input type="text" id="frota3" class="form-control" placeholder="Frota" style="width: 90px;">
                    <input type="time" id="hSaida3" class="form-control" placeholder="H. sa√≠da" style="width: 90px;">
                    <input type="time" id="hEntrada3" class="form-control" placeholder="H. entrada" style="width: 90px;">
                    <input type="number" id="kmSaida3" class="form-control" placeholder="Km. sa√≠da" style="width: 100px;">
                    <input type="number" id="kmEntrada3" class="form-control" placeholder="Km. entrada" style="width: 100px;">
                    <input type="text" id="obs3" class="form-control" placeholder="Obs" style="flex-grow: 1;">
                </div>
            `,
            4: `
                <div class="form-container d-flex flex-wrap gap-2 mb-2">
                    <input type="date" id="data4" class="form-control" style="width: 110px;">
                    <input type="text" id="motorista4" class="form-control" placeholder="Motorista" style="width: 120px;">
                    <input type="text" id="frota4" class="form-control" placeholder="Frota" style="width: 90px;">
                    <input type="time" id="hSaida4" class="form-control" placeholder="H. sa√≠da" style="width: 90px;">
                    <input type="time" id="hEntrada4" class="form-control" placeholder="H. entrada" style="width: 90px;">
                    <input type="number" id="kmSaida4" class="form-control" placeholder="Km. sa√≠da" style="width: 100px;">
                    <input type="number" id="kmEntrada4" class="form-control" placeholder="Km. entrada" style="width: 100px;">
                    <input type="text" id="obs4" class="form-control" placeholder="Obs" style="flex-grow: 1;">
                </div>
            `,
            5: `
                <div class="form-container d-flex flex-wrap gap-2 mb-2">
                    <input type="date" id="data5" class="form-control" style="width: 110px;">
                    <input type="text" id="nome5" class="form-control" placeholder="Nome" style="width: 150px;">
                    <input type="text" id="placa5" class="form-control" placeholder="Placa" style="width: 100px;">
                    <input type="text" id="modelo5" class="form-control" placeholder="Modelo" style="width: 120px;">
                    <input type="time" id="horario5" class="form-control" placeholder="Hor√°rio" style="width: 90px;">
                    <input type="text" id="setor5" class="form-control" placeholder="Setor" style="width: 100px;">
                    <input type="text" id="obs5" class="form-control" placeholder="Obs" style="flex-grow: 1;">
                </div>
            `
        };

        function updateForm() {
            const footer = document.getElementById('form-container-footer');
            footer.innerHTML = forms[activeTab] + `
                <div class="d-flex justify-content-end gap-2">
                    <button class="btn btn-danger btn-sm" onclick="deletarSelecionados()">üóëÔ∏è Deletar Selecionados</button>
                    <button class="btn btn-success btn-sm" onclick="salvar()">üíæ Salvar</button>
                    <button class="btn btn-secondary btn-sm" onclick="exportTxt()">‚¨áÔ∏è TXT</button>
                    <button class="btn btn-primary btn-sm" onclick="exportExcel()">‚¨áÔ∏è Excel</button>
                </div>
            `;
            if (activeTab === 1) {
                const origem = document.getElementById(`origem${activeTab}`);
                const destino = document.getElementById(`destino${activeTab}`);
                opcoes.forEach(op => {
                    origem.innerHTML += `<option value="${op}">${op}</option>`;
                    destino.innerHTML += `<option value="${op}">${op}</option>`;
                });
            }
            if (activeTab === 5) {
                document.getElementById('placa5').addEventListener('input', autocompletarPlaca);
            }
        }
        
        document.querySelectorAll('.nav-link').forEach(tab => {
            tab.addEventListener('shown.bs.tab', event => {
                const targetId = event.target.getAttribute('data-bs-target');
                activeTab = parseInt(targetId.replace('#tab', ''));
                updateForm();
                atualizarOutput();
            });
        });

        function getLocalStorageKey() {
            switch (activeTab) {
                case 1: return `registros-aba1`;
                case 2: return `registros-coleta`;
                case 3: return `registros-293`;
                case 4: return `registros-294`;
                case 5: return `registros-retira`;
                default: return `registros-aba${activeTab}`;
            }
        }
        
        function getOutputId() {
            return `output${activeTab}`;
        }
        
        function getFiltroId() {
            return `filtro${activeTab}`;
        }
        
        function getOrdenarPorId() {
            return `ordenarPor${activeTab}`;
        }

        function salvar() {
            let registro = {};
            let registros = JSON.parse(localStorage.getItem(getLocalStorageKey()) || "[]");
            const tabNumber = activeTab;

            if (tabNumber === 1) {
                registro = {
                    data: document.getElementById(`data${tabNumber}`).value,
                    cavalo: document.getElementById(`cavalo${tabNumber}`).value,
                    carreta1: document.getElementById(`carreta1${tabNumber}`).value,
                    carreta2: document.getElementById(`carreta2${tabNumber}`).value,
                    hChegada: document.getElementById(`hChegada${tabNumber}`).value,
                    hSaida: document.getElementById(`hSaida${tabNumber}`).value,
                    motChegada: document.getElementById(`motChegada${tabNumber}`).value,
                    motSaida: document.getElementById(`motSaida${tabNumber}`).value,
                    origem: document.getElementById(`origem${tabNumber}`).value,
                    destino: document.getElementById(`destino${tabNumber}`).value
                };
            } else if (tabNumber === 2 || tabNumber === 3 || tabNumber === 4) {
                registro = {
                    data: document.getElementById(`data${tabNumber}`).value,
                    motorista: document.getElementById(`motorista${tabNumber}`).value,
                    frota: document.getElementById(`frota${tabNumber}`).value,
                    hSaida: document.getElementById(`hSaida${tabNumber}`).value,
                    hEntrada: document.getElementById(`hEntrada${tabNumber}`).value,
                    kmSaida: document.getElementById(`kmSaida${tabNumber}`).value,
                    kmEntrada: document.getElementById(`kmEntrada${tabNumber}`).value,
                    obs: document.getElementById(`obs${tabNumber}`).value,
                };
            } else if (tabNumber === 5) {
                registro = {
                    data: document.getElementById(`data${tabNumber}`).value,
                    nome: document.getElementById(`nome${tabNumber}`).value,
                    placa: document.getElementById(`placa${tabNumber}`).value.toUpperCase(),
                    modelo: document.getElementById(`modelo${tabNumber}`).value,
                    horario: document.getElementById(`horario${tabNumber}`).value,
                    setor: document.getElementById(`setor${tabNumber}`).value,
                    obs: document.getElementById(`obs${tabNumber}`).value,
                };
            }

            if (editIndex >= 0) {
                registros[editIndex] = registro;
                editIndex = -1;
            } else {
                registros.push(registro);
            }

            localStorage.setItem(getLocalStorageKey(), JSON.stringify(registros));
            limparCampos();
            atualizarOutput();
        }

        function limparCampos() {
            const tabNumber = activeTab;
            if (tabNumber === 1) {
                document.getElementById('data1').value = "";
                document.getElementById('cavalo1').value = "";
                document.getElementById('carreta11').value = "";
                document.getElementById('carreta21').value = "";
                document.getElementById('hChegada1').value = "";
                document.getElementById('hSaida1').value = "";
                document.getElementById('motChegada1').value = "";
                document.getElementById('motSaida1').value = "";
                document.getElementById('origem1').value = "";
                document.getElementById('destino1').value = "";
            } else if (tabNumber === 2 || tabNumber === 3 || tabNumber === 4) {
                document.getElementById(`data${tabNumber}`).value = "";
                document.getElementById(`motorista${tabNumber}`).value = "";
                document.getElementById(`frota${tabNumber}`).value = "";
                document.getElementById(`hSaida${tabNumber}`).value = "";
                document.getElementById(`hEntrada${tabNumber}`).value = "";
                document.getElementById(`kmSaida${tabNumber}`).value = "";
                document.getElementById(`kmEntrada${tabNumber}`).value = "";
                document.getElementById(`obs${tabNumber}`).value = "";
            } else if (tabNumber === 5) {
                document.getElementById('data5').value = "";
                document.getElementById('nome5').value = "";
                document.getElementById('placa5').value = "";
                document.getElementById('modelo5').value = "";
                document.getElementById('horario5').value = "";
                document.getElementById('setor5').value = "";
                document.getElementById('obs5').value = "";
            }
        }

        function autocompletarPlaca() {
            if (activeTab !== 5) return;
            const placaInput = document.getElementById('placa5');
            const placa = placaInput.value.toUpperCase().trim();
            const registros = JSON.parse(localStorage.getItem('registros-retira') || "[]");

            const registroEncontrado = registros.find(r => r.placa === placa);

            if (registroEncontrado) {
                document.getElementById('nome5').value = registroEncontrado.nome;
                document.getElementById('modelo5').value = registroEncontrado.modelo;
                document.getElementById('setor5').value = registroEncontrado.setor;
            } else {
                if (editIndex === -1) {
                    document.getElementById('nome5').value = '';
                    document.getElementById('modelo5').value = '';
                    document.getElementById('setor5').value = '';
                }
            }
        }

        function atualizarOutput() {
            const output = document.getElementById(getOutputId());
            output.innerHTML = "";
            selectedIndices = [];

            let registros = JSON.parse(localStorage.getItem(getLocalStorageKey()) || "[]");

            const filtroInput = document.getElementById(getFiltroId());
            const filtro = filtroInput ? filtroInput.value.toLowerCase() : "";
            const ordenar = document.getElementById(getOrdenarPorId()).value;
            const tabNumber = activeTab;
            
            registros = registros.filter(r => {
                if (tabNumber === 1) {
                    return r.cavalo?.toLowerCase().includes(filtro) ||
                           r.motChegada?.toLowerCase().includes(filtro) ||
                           r.motSaida?.toLowerCase().includes(filtro) ||
                           r.data?.includes(filtro);
                } else if (tabNumber === 2 || tabNumber === 3 || tabNumber === 4) {
                    return r.motorista?.toLowerCase().includes(filtro) ||
                           r.frota?.toLowerCase().includes(filtro) ||
                           r.data?.includes(filtro);
                } else if (tabNumber === 5) {
                    return r.nome?.toLowerCase().includes(filtro) ||
                           r.placa?.toLowerCase().includes(filtro) ||
                           r.data?.includes(filtro);
                }
                return true;
            });

            registros.sort((a, b) => {
                if (ordenar === 'data') {
                    return (a.data + (a.horario || a.hChegada || '') + (a.hSaida || '')).localeCompare(b.data + (b.horario || b.hChegada || '') + (b.hSaida || ''));
                }
                return (a[ordenar] || "").localeCompare(b[ordenar] || "");
            });

            registros.forEach((r, i) => {
                const linha = document.createElement("div");
                let textContent = "";
                if (tabNumber === 1) {
                    textContent = `Data: ${r.data} Cavalo: ${r.cavalo} Carreta1: ${r.carreta1} Carreta2: ${r.carreta2} ` +
                                  `H. Chegada: ${r.hChegada} H. Sa√≠da: ${r.hSaida} Mot. Chegada: ${r.motChegada} Mot. Sa√≠da: ${r.motSaida} ` +
                                  `Origem: ${r.origem} Destino: ${r.destino}`;
                } else if (tabNumber === 2 || tabNumber === 3 || tabNumber === 4) {
                    textContent = `Data: ${r.data} Motorista: ${r.motorista} Frota: ${r.frota} ` +
                                  `H. sa√≠da: ${r.hSaida} H. entrada: ${r.hEntrada} Km. sa√≠da: ${r.kmSaida} ` +
                                  `Km. entrada: ${r.kmEntrada} Obs: ${r.obs}`;
                } else if (tabNumber === 5) {
                    textContent = `Data: ${r.data} Nome: ${r.nome} Placa: ${r.placa} Modelo: ${r.modelo} ` +
                                  `Hor√°rio: ${r.horario} Setor: ${r.setor} Obs: ${r.obs}`;
                }
                
                linha.innerHTML = `<input type="checkbox" data-index="${i}"> ${textContent}`;
                linha.querySelector('input').addEventListener('change', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    if (e.target.checked) {
                        selectedIndices.push(index);
                    } else {
                        selectedIndices = selectedIndices.filter(item => item !== index);
                    }
                });
                linha.ondblclick = () => editar(i);
                output.appendChild(linha);
            });
        }
        
        function deletarSelecionados() {
            if (selectedIndices.length === 0) {
                alert("Nenhum item selecionado para deletar.");
                return;
            }
            if (confirm(`Tem certeza que deseja deletar os ${selectedIndices.length} registro(s) selecionado(s)?`)) {
                let registros = JSON.parse(localStorage.getItem(getLocalStorageKey()) || "[]");
                
                // Ordena os √≠ndices em ordem decrescente para evitar problemas ao deletar
                selectedIndices.sort((a, b) => b - a);
                
                selectedIndices.forEach(index => {
                    if (registros[index]) {
                        registros.splice(index, 1);
                    }
                });
                
                localStorage.setItem(getLocalStorageKey(), JSON.stringify(registros));
                atualizarOutput();
            }
        }

        function editar(i) {
            const r = JSON.parse(localStorage.getItem(getLocalStorageKey()))[i];
            const tabNumber = activeTab;

            if (tabNumber === 1) {
                document.getElementById(`data${tabNumber}`).value = r.data;
                document.getElementById(`cavalo${tabNumber}`).value = r.cavalo;
                document.getElementById(`carreta1${tabNumber}`).value = r.carreta1;
                document.getElementById(`carreta2${tabNumber}`).value = r.carreta2;
                document.getElementById(`hChegada${tabNumber}`).value = r.hChegada;
                document.getElementById(`hSaida${tabNumber}`).value = r.hSaida;
                document.getElementById(`motChegada${tabNumber}`).value = r.motChegada;
                document.getElementById(`motSaida${tabNumber}`).value = r.motSaida;
                document.getElementById(`origem${tabNumber}`).value = r.origem;
                document.getElementById(`destino${tabNumber}`).value = r.destino;
            } else if (tabNumber === 2 || tabNumber === 3 || tabNumber === 4) {
                document.getElementById(`data${tabNumber}`).value = r.data;
                document.getElementById(`motorista${tabNumber}`).value = r.motorista;
                document.getElementById(`frota${tabNumber}`).value = r.frota;
                document.getElementById(`hSaida${tabNumber}`).value = r.hSaida;
                document.getElementById(`hEntrada${tabNumber}`).value = r.hEntrada;
                document.getElementById(`kmSaida${tabNumber}`).value = r.kmSaida;
                document.getElementById(`kmEntrada${tabNumber}`).value = r.kmEntrada;
                document.getElementById(`obs${tabNumber}`).value = r.obs;
            } else if (tabNumber === 5) {
                document.getElementById(`data${tabNumber}`).value = r.data;
                document.getElementById(`nome${tabNumber}`).value = r.nome;
                document.getElementById(`placa${tabNumber}`).value = r.placa;
                document.getElementById(`modelo${tabNumber}`).value = r.modelo;
                document.getElementById(`horario${tabNumber}`).value = r.horario;
                document.getElementById(`setor${tabNumber}`).value = r.setor;
                document.getElementById(`obs${tabNumber}`).value = r.obs;
            }
            editIndex = i;
        }

        function exportTxt() {
            const registros = JSON.parse(localStorage.getItem(getLocalStorageKey()) || "[]");
            const linhas = registros.map(r => {
                if (activeTab === 1) {
                    return `Data: ${r.data} Cavalo: ${r.cavalo} Carreta1: ${r.carreta1} Carreta2: ${r.carreta2} ` +
                           `H.Chegada: ${r.hChegada} H.Sa√≠da: ${r.hSaida} Mot.Chegada: ${r.motChegada} Mot.Sa√≠da: ${r.motSaida} ` +
                           `Origem: ${r.origem} Destino: ${r.destino}`;
                } else if (activeTab === 2 || activeTab === 3 || activeTab === 4) {
                    return `Data: ${r.data} Motorista: ${r.motorista} Frota: ${r.frota} ` +
                           `H. sa√≠da: ${r.hSaida} H. entrada: ${r.hEntrada} Km. sa√≠da: ${r.kmSaida} ` +
                           `Km. entrada: ${r.kmEntrada} Obs: ${r.obs}`;
                } else if (activeTab === 5) {
                    return `Data: ${r.data} Nome: ${r.nome} Placa: ${r.placa} Modelo: ${r.modelo} ` +
                           `Hor√°rio: ${r.horario} Setor: ${r.setor} Obs: ${r.obs}`;
                }
                return "";
            });
            const blob = new Blob([linhas.join("\n")], { type: "text/plain" });
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = `${getLocalStorageKey()}.txt`;
            a.click();
        }

        function exportExcel() {
            const registros = JSON.parse(localStorage.getItem(getLocalStorageKey()) || "[]");
            const ws = XLSX.utils.json_to_sheet(registros);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Registros");
            XLSX.writeFile(wb, `${getLocalStorageKey()}.xlsx`);
        }
        
        document.querySelectorAll("[id^=filtro]").forEach(el => el.addEventListener("input", atualizarOutput));
        document.querySelectorAll("[id^=ordenarPor]").forEach(el => el.addEventListener("change", atualizarOutput));

        window.onload = () => {
            updateForm();
            atualizarOutput();

            document.addEventListener("keydown", e => {
                if (e.ctrlKey && e.key === "s") {
                    e.preventDefault();
                    salvar();
                } else if (e.ctrlKey && e.key === "f") {
                    e.preventDefault();
                    document.getElementById(getFiltroId()).focus();
                } else if (e.key === "Escape") {
                    limparCampos();
                    editIndex = -1;
                }
            });
        };
    </script>
</body>
</html>
